I"Ë<p><span style="color:blue;"><span style="color:blue;">  <span><u>How to compare two different tables attributes of two databases in a server?</u></span><br /><br /><span>use</span></span></span><span> </span><span style="color:blue;"><span style="color:blue;"><span>master</span></span></span><span>GO</span><br /><span>if </span><br /><span><span style="color:grey;"><span style="color:grey;">(</span></span> <span style="color:blue;"><span style="color:blue;">select</span></span> <span style="color:magenta;"><span style="color:magenta;">count</span></span><span style="color:grey;"><span style="color:grey;">(*)</span></span> <span style="color:blue;"><span style="color:blue;">from</span></span> <span style="color:green;"><span style="color:green;">sysobjects</span></span> <span style="color:blue;"><span style="color:blue;">where</span></span> id <span style="color:grey;"><span style="color:grey;">=</span></span> <span style="color:magenta;"><span style="color:magenta;">object_id</span></span><span style="color:grey;"><span style="color:grey;">(</span></span><span style="color:red;"><span style="color:red;">Nâ€™sp_CompareDbTablesâ€™</span></span><span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;">&gt;</span></span></span><span> 0 </span><span><span style="color:blue;"><span style="color:blue;">drop</span></span> <span style="color:blue;"><span style="color:blue;">proc</span></span> sp_CompareDbTables</span><br /><span style="color:blue;"><span style="color:blue;"><span>GO</span><br /><span>create</span></span></span><span> <span style="color:blue;"><span style="color:blue;">proc</span></span></span><span> sp_CompareDbTables</span><span>@dbA_Name </span><span style="color:blue;"><span style="color:blue;"><span>sysname</span></span></span><br /><span><span style="color:grey;"><span style="color:grey;">,</span></span> @dbB_Name <span style="color:blue;"><span style="color:blue;">sysname</span></span></span><br /><span><span style="color:grey;"><span style="color:grey;">,</span></span> @TableNameLike <span style="color:blue;"><span style="color:blue;">varchar</span></span><span style="color:grey;"><span style="color:grey;">(</span></span>100<span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;">=</span></span> <span style="color:grey;"><span style="color:grey;">null</span></span></span><span> </span><br /><span style="color:green;"><span style="color:green;"><span>â€“ null = All Tables, â€˜IBTA%â€™ = Tables like â€˜IBTA%â€™</span></span></span><br /><span><span style="color:grey;"><span style="color:grey;">,</span></span> @CompareOnlyDifference <span style="color:blue;"><span style="color:blue;">int</span></span> <span style="color:grey;"><span style="color:grey;">=</span></span></span><span> 1 </span><br /><span style="color:green;"><span style="color:green;"><span>â€“ 1 = Compare only difference, 0 = Compare all</span></span></span><br /><span style="color:blue;"><span>AS</span></span><span style="color:green;"><span style="color:green;"><span>/*</span><br /><span>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br /><span>Purpose : Comparing Tables in two databases in a server</span><br /><span>Returns Table Name along with number of fields from two databases</span><br /><span>Exec Sample : </span><br /><span>For Comparison only difference of tables :</span><br /><span>exec sp_CompareDbTables â€˜db_pcbank2000â€™, â€˜db_pcbank2000backâ€™</span><br /><span>For Comparison of all tables :</span><br /><span>exec sp_CompareDbTables â€˜db_pcbank2000â€™, â€˜db_pcbank2000backâ€™, â€˜%â€™, 0</span><br /><span>For Comparison (only difference) of specific types of table like IBTA% :</span><br /><span>exec sp_CompareDbTables â€˜db_pcbank2000â€™, â€˜db_pcbank2000backâ€™, â€˜IBTA%â€™</span><br /><span>For Comparison of specific types of table like IBTA% :</span><br /><span>exec sp_CompareDbTables â€˜db_pcbank2000â€™, â€˜db_pcbank2000backâ€™, â€˜IBTA%â€™, 0</span><br /><span>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br /><span>*/</span></span></span><span><span style="color:blue;"><span style="color:blue;">declare</span></span> @vQuery <span style="color:blue;"><span style="color:blue;">nvarchar</span></span><span style="color:grey;"><span style="color:grey;">(</span></span>4000<span style="color:grey;"><span style="color:grey;">)</span></span></span><br /><span><span style="color:blue;"><span style="color:blue;">set</span></span> <span style="color:blue;"><span style="color:blue;">nocount</span></span> <span style="color:blue;"><span style="color:blue;">on</span></span></span><br /><span><span style="color:blue;"><span style="color:blue;">if </span></span><span style="color:grey;"><span style="color:grey;">(</span></span> <span style="color:blue;"><span style="color:blue;">select</span></span> <span style="color:magenta;"><span style="color:magenta;">count</span></span><span style="color:grey;"><span style="color:grey;">(*)</span></span> <span style="color:blue;"><span style="color:blue;">from</span></span> <span style="color:blue;"><span style="color:blue;">master</span></span><span style="color:grey;"><span style="color:grey;">..</span></span><span style="color:green;"><span style="color:green;">sysdatabases</span></span> <span style="color:blue;"><span style="color:blue;">where</span></span> <span style="color:blue;"><span style="color:blue;">dbid</span></span> <span style="color:grey;"><span style="color:grey;">=</span></span> <span style="color:magenta;"><span style="color:magenta;">db_id</span></span><span style="color:grey;"><span style="color:grey;">(</span></span> @dbA_Name <span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;">=</span></span> 0 <span style="color:blue;"><span style="color:blue;">begin</span></span></span><br /><span><span style="color:blue;"><span style="color:blue;">raiserror </span></span><span style="color:grey;"><span style="color:grey;">(</span></span> <span style="color:red;"><span style="color:red;">â€˜Database namely â€˜â€˜%sâ€™â€™ does not exist in the server %sâ€™</span></span></span><br /><span><span style="color:grey;"><span style="color:grey;">,</span></span> 16<span style="color:grey;"><span style="color:grey;">,</span></span> 1<span style="color:grey;"><span style="color:grey;">,</span></span> @dbA_Name<span style="color:grey;"><span style="color:grey;">,</span></span> <span style="color:magenta;"><span style="color:magenta;">@@servername</span></span> <span style="color:grey;"><span style="color:grey;">)</span></span></span><br /><span><span style="color:blue;"><span style="color:blue;">return </span></span><span style="color:grey;"><span style="color:grey;">(</span></span> 1 <span style="color:grey;"><span style="color:grey;">)</span></span></span><br /><span style="color:blue;"><span style="color:blue;"><span>end</span></span></span><br /><span><span style="color:blue;"><span style="color:blue;">else</span></span> <span style="color:blue;"><span style="color:blue;">if </span></span><span style="color:grey;"><span style="color:grey;">(</span></span> <span style="color:blue;"><span style="color:blue;">select</span></span> <span style="color:magenta;"><span style="color:magenta;">count</span></span><span style="color:grey;"><span style="color:grey;">(*)</span></span> <span style="color:blue;"><span style="color:blue;">from</span></span> <span style="color:blue;"><span style="color:blue;">master</span></span><span style="color:grey;"><span style="color:grey;">..</span></span><span style="color:green;"><span style="color:green;">sysdatabases</span></span> <span style="color:blue;"><span style="color:blue;">where</span></span> <span style="color:blue;"><span style="color:blue;">dbid</span></span> <span style="color:grey;"><span style="color:grey;">=</span></span> <span style="color:magenta;"><span style="color:magenta;">db_id</span></span><span style="color:grey;"><span style="color:grey;">(</span></span> @dbB_Name <span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;">=</span></span> 0 <span style="color:blue;"><span style="color:blue;">begin</span></span></span><br /><span><span style="color:blue;"><span style="color:blue;">raiserror </span></span><span style="color:grey;"><span style="color:grey;">(</span></span> <span style="color:red;"><span style="color:red;">â€˜Database namely â€˜â€˜%sâ€™â€™ does not exist in the server %sâ€™</span></span></span><br /><span><span style="color:grey;"><span style="color:grey;">,</span></span> 16<span style="color:grey;"><span style="color:grey;">,</span></span> 1<span style="color:grey;"><span style="color:grey;">,</span></span> @dbB_Name<span style="color:grey;"><span style="color:grey;">,</span></span> <span style="color:magenta;"><span style="color:magenta;">@@servername</span></span> <span style="color:grey;"><span style="color:grey;">)</span></span></span><br /><span><span style="color:blue;"><span style="color:blue;">return </span></span><span style="color:grey;"><span style="color:grey;">(</span></span> 1 <span style="color:grey;"><span style="color:grey;">)</span></span></span><br /><span style="color:blue;"><span style="color:blue;"><span>end</span></span></span><br /><span><span style="color:blue;"><span style="color:blue;">set</span></span> @TableNameLike <span style="color:grey;"><span style="color:grey;">=</span></span> <span style="color:magenta;"><span style="color:magenta;">isnull</span></span><span style="color:grey;"><span style="color:grey;">(</span></span> @TableNameLike<span style="color:grey;"><span style="color:grey;">,</span></span> <span style="color:red;"><span style="color:red;">â€™â€™</span></span> <span style="color:grey;"><span style="color:grey;">)</span></span></span><br /><span><span style="color:blue;"><span style="color:blue;">set</span></span> @TableNameLike <span style="color:grey;"><span style="color:grey;">=</span></span><span style="color:blue;"><span style="color:blue;"> </span></span><span style="color:grey;"><span style="color:grey;">(</span></span> <span style="color:blue;"><span style="color:blue;">case</span></span> @TableNameLike <span style="color:blue;"><span style="color:blue;">when</span></span> <span style="color:red;"><span style="color:red;">â€™â€™</span></span> <span style="color:blue;"><span style="color:blue;">then</span></span> <span style="color:red;"><span style="color:red;">â€™%â€™</span></span> <span style="color:blue;"><span style="color:blue;">else</span></span> @TableNameLike <span style="color:blue;"><span style="color:blue;">end</span></span> <span style="color:grey;"><span style="color:grey;">)</span></span></span><br /><span><span style="color:blue;"><span style="color:blue;">if </span></span><span style="color:grey;"><span style="color:grey;">(</span></span> <span style="color:blue;"><span style="color:blue;">select</span></span> <span style="color:magenta;"><span style="color:magenta;">count</span></span><span style="color:grey;"><span style="color:grey;">(*)</span></span> <span style="color:blue;"><span style="color:blue;">from</span></span> tempdb<span style="color:grey;"><span style="color:grey;">..</span></span><span style="color:green;"><span style="color:green;">sysobjects</span></span> <span style="color:blue;"><span style="color:blue;">where</span></span> id <span style="color:grey;"><span style="color:grey;">=</span></span> <span style="color:magenta;"><span style="color:magenta;">object_id</span></span><span style="color:grey;"><span style="color:grey;">(</span></span><span style="color:red;"><span style="color:red;">Nâ€™tempdb.._tempDbAâ€™</span></span><span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;">&gt;</span></span></span><span> 0</span><br /><span><span style="color:blue;"><span style="color:blue;">drop</span></span> <span style="color:blue;"><span style="color:blue;">table</span></span> tempdb<span style="color:grey;"><span style="color:grey;">..</span></span></span><span>_tempDbA</span><br /><span><span style="color:blue;"><span style="color:blue;">if </span></span><span style="color:grey;"><span style="color:grey;">(</span></span> <span style="color:blue;"><span style="color:blue;">select</span></span> <span style="color:magenta;"><span style="color:magenta;">count</span></span><span style="color:grey;"><span style="color:grey;">(*)</span></span> <span style="color:blue;"><span style="color:blue;">from</span></span> tempdb<span style="color:grey;"><span style="color:grey;">..</span></span><span style="color:green;"><span style="color:green;">sysobjects</span></span> <span style="color:blue;"><span style="color:blue;">where</span></span> id <span style="color:grey;"><span style="color:grey;">=</span></span> <span style="color:magenta;"><span style="color:magenta;">object_id</span></span><span style="color:grey;"><span style="color:grey;">(</span></span><span style="color:red;"><span style="color:red;">Nâ€™tempdb.._tempDbBâ€™</span></span><span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;">&gt;</span></span></span><span> 0</span><br /><span><span style="color:blue;"><span style="color:blue;">drop</span></span> <span style="color:blue;"><span style="color:blue;">table</span></span> tempdb<span style="color:grey;"><span style="color:grey;">..</span></span></span><span>_tempDbB</span><br /><span><span style="color:blue;"><span style="color:blue;">create</span></span> <span style="color:blue;"><span style="color:blue;">table</span></span> tempdb<span style="color:grey;"><span style="color:grey;">..</span></span>_tempDbA<span style="color:grey;"><span style="color:grey;">(</span></span> Name <span style="color:blue;"><span style="color:blue;">sysname</span></span> <span style="color:grey;"><span style="color:grey;">)</span></span></span><br /><span><span style="color:blue;"><span style="color:blue;">create</span></span> <span style="color:blue;"><span style="color:blue;">table</span></span> tempdb<span style="color:grey;"><span style="color:grey;">..</span></span>_tempDbB<span style="color:grey;"><span style="color:grey;">(</span></span> Name <span style="color:blue;"><span style="color:blue;">sysname</span></span> <span style="color:grey;"><span style="color:grey;">)</span></span></span><br /><span></span><br /><span><span style="color:blue;"><span style="color:blue;">set</span></span> @vQuery <span style="color:grey;"><span style="color:grey;">=</span></span> <span style="color:red;"><span style="color:red;">Nâ€™use â€˜</span></span> <span style="color:grey;"><span style="color:grey;">+</span></span> @dbA_Name <span style="color:grey;"><span style="color:grey;">+</span></span> </span><span style="color:red;"><span style="color:red;"><span>â€™</span></span></span><br /><span>insert into tempdb.._tempDbA select Name from sysobjects</span><br /><span>where OBJECTPROPERTY(id, Nâ€™â€˜IsUserTableâ€™â€™) = 1</span><br /><span>order by Nameâ€™</span><br /><span><span style="color:blue;"><span style="color:blue;">exec</span></span> <span style="color:maroon;"><span style="color:maroon;">sp_executesql</span></span><span style="color:blue;"><span style="color:blue;"> </span></span></span><span>@vQuery</span><br /><span></span><br /><span><span style="color:blue;"><span style="color:blue;">set</span></span> @vQuery <span style="color:grey;"><span style="color:grey;">=</span></span> <span style="color:red;"><span style="color:red;">Nâ€™use â€˜</span></span> <span style="color:grey;"><span style="color:grey;">+</span></span> @dbB_Name <span style="color:grey;"><span style="color:grey;">+</span></span> </span><span style="color:red;"><span style="color:red;"><span>â€™</span></span></span><br /><span>insert into tempdb.._tempDbB select Name from sysobjects</span><br /><span>where OBJECTPROPERTY(id, Nâ€™â€˜IsUserTableâ€™â€™) = 1</span><br /><span>order by Nameâ€™</span><br /><span></span><br /><span><span style="color:blue;"><span style="color:blue;">exec</span></span> <span style="color:maroon;"><span style="color:maroon;">sp_executesql</span></span><span style="color:blue;"><span style="color:blue;"> </span></span></span><span>@vQuery</span><br /><span></span><br /><span><span style="color:blue;"><span style="color:blue;">create</span></span> <span style="color:blue;"><span style="color:blue;">table</span></span> #Compare</span><br /><span style="color:blue;"><span style="color:blue;"></span></span><span><span style="color:grey;"><span style="color:grey;">(</span></span>dbA_TableName <span style="color:blue;"><span style="color:blue;">sysname</span></span> <span style="color:grey;"><span style="color:grey;">null,</span></span> dbB_TableName <span style="color:blue;"><span style="color:blue;">sysname</span></span> <span style="color:grey;"><span style="color:grey;">null</span></span></span><span><span style="color:grey;"><span style="color:grey;">,</span></span> dbA_TableFields <span style="color:blue;"><span style="color:blue;">int</span></span><span style="color:grey;"><span style="color:grey;">,</span></span> dbB_TableFields <span style="color:blue;"><span style="color:blue;">int</span></span><span style="color:grey;"><span style="color:grey;">)</span></span></span><br /><span></span><br /><span><span style="color:blue;"><span style="color:blue;">insert</span></span> <span style="color:blue;"><span style="color:blue;">into</span></span> #Compare<span style="color:blue;"><span style="color:blue;"> </span></span><span style="color:grey;"><span style="color:grey;">(</span></span> dbA_TableName<span style="color:grey;"><span style="color:grey;">,</span></span> dbB_TableName <span style="color:grey;"><span style="color:grey;">)</span></span></span><br /><span><span style="color:blue;"><span style="color:blue;">select</span></span> dbA_TableName <span style="color:grey;"><span style="color:grey;">=</span></span> a<span style="color:grey;"><span style="color:grey;">.</span></span></span><span>Name</span><br /><span><span style="color:grey;"><span style="color:grey;">,</span></span> dbB_TableName <span style="color:grey;"><span style="color:grey;">=</span></span> b<span style="color:grey;"><span style="color:grey;">.</span></span></span><span>Name</span><br /><span><span style="color:blue;"><span style="color:blue;">from</span></span> tempdb<span style="color:grey;"><span style="color:grey;">..</span></span>_tempDbA a <span style="color:blue;"><span style="color:blue;">full</span></span> <span style="color:grey;"><span style="color:grey;">outer</span></span> <span style="color:grey;"><span style="color:grey;">join</span></span> tempdb<span style="color:grey;"><span style="color:grey;">..</span></span>_tempDbB b <span style="color:blue;"><span style="color:blue;">on</span></span> a<span style="color:grey;"><span style="color:grey;">.</span></span>Name <span style="color:grey;"><span style="color:grey;">=</span></span> b<span style="color:grey;"><span style="color:grey;">.</span></span></span><span>Name</span><br /><span><span style="color:blue;"><span style="color:blue;">order</span></span> <span style="color:blue;"><span style="color:blue;">by</span></span> <span style="color:magenta;"><span style="color:magenta;">isnull</span></span><span style="color:grey;"><span style="color:grey;">(</span></span> a<span style="color:grey;"><span style="color:grey;">.</span></span>Name<span style="color:grey;"><span style="color:grey;">,</span></span> <span style="color:red;"><span style="color:red;">â€™â€™</span></span><span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;">+</span></span> <span style="color:magenta;"><span style="color:magenta;">isnull</span></span><span style="color:grey;"><span style="color:grey;">(</span></span> b<span style="color:grey;"><span style="color:grey;">.</span></span>Name<span style="color:grey;"><span style="color:grey;">,</span></span> <span style="color:red;"><span style="color:red;">â€™â€™</span></span> <span style="color:grey;"><span style="color:grey;">)</span></span></span><br /><span><span style="color:blue;"><span style="color:blue;">if </span></span><span style="color:grey;"><span style="color:grey;">(</span></span> <span style="color:blue;"><span style="color:blue;">select</span></span> <span style="color:magenta;"><span style="color:magenta;">count</span></span><span style="color:grey;"><span style="color:grey;">(*)</span></span> <span style="color:blue;"><span style="color:blue;">from</span></span> tempdb<span style="color:grey;"><span style="color:grey;">..</span></span><span style="color:green;"><span style="color:green;">sysobjects</span></span> <span style="color:blue;"><span style="color:blue;">where</span></span> id <span style="color:grey;"><span style="color:grey;">=</span></span> <span style="color:magenta;"><span style="color:magenta;">object_id</span></span><span style="color:grey;"><span style="color:grey;">(</span></span><span style="color:red;"><span style="color:red;">Nâ€™tempdb.._tempDbAâ€™</span></span><span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;">&gt;</span></span></span><span> 0</span><br /><span><span style="color:blue;"><span style="color:blue;">drop</span></span> <span style="color:blue;"><span style="color:blue;">table</span></span> tempdb<span style="color:grey;"><span style="color:grey;">..</span></span></span><span>_tempDbA</span><br /><span><span style="color:blue;"><span style="color:blue;">if </span></span><span style="color:grey;"><span style="color:grey;">(</span></span> <span style="color:blue;"><span style="color:blue;">select</span></span> <span style="color:magenta;"><span style="color:magenta;">count</span></span><span style="color:grey;"><span style="color:grey;">(*)</span></span> <span style="color:blue;"><span style="color:blue;">from</span></span> tempdb<span style="color:grey;"><span style="color:grey;">..</span></span><span style="color:green;"><span style="color:green;">sysobjects</span></span> <span style="color:blue;"><span style="color:blue;">where</span></span> id <span style="color:grey;"><span style="color:grey;">=</span></span> <span style="color:magenta;"><span style="color:magenta;">object_id</span></span><span style="color:grey;"><span style="color:grey;">(</span></span><span style="color:red;"><span style="color:red;">Nâ€™tempdb.._tempDbBâ€™</span></span><span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;">&gt;</span></span></span><span> 0</span><br /><span><span style="color:blue;"><span style="color:blue;">drop</span></span> <span style="color:blue;"><span style="color:blue;">table</span></span> tempdb<span style="color:grey;"><span style="color:grey;">..</span></span></span><span>_tempDbB</span><br /><span></span><br /><span><span style="color:blue;"><span style="color:blue;">set</span></span> @vQuery <span style="color:grey;"><span style="color:grey;">=</span></span> </span><span style="color:red;"><span style="color:red;"><span>Nâ€™update #Compare set dbA_TableFields </span></span></span><br /><span>= ( select count(*) from â€˜</span><br /><span> <span style="color:grey;"><span style="color:grey;">+</span></span> @dbA_Name <span style="color:grey;"><span style="color:grey;">+</span></span> </span><span style="color:red;"><span style="color:red;"><span>â€™..syscolumns </span></span></span><span>where id = object_id (Nâ€™â€™â€™</span><br /><span> <span style="color:grey;"><span style="color:grey;">+</span></span> @dbA_Name <span style="color:grey;"><span style="color:grey;">+</span></span> </span><span style="color:red;"><span style="color:red;"><span>â€™..â€™â€™ + dbA_TableName ) )</span></span></span><span>from #Compare where dbA_TableName is not nullâ€™</span><br /><span><span style="color:blue;"><span style="color:blue;">exec</span></span> <span style="color:maroon;"><span style="color:maroon;">sp_executesql</span></span><span style="color:blue;"><span style="color:blue;"> </span></span></span><span>@vQuery</span><br /><span></span><br /><span><span style="color:blue;"><span style="color:blue;">set</span></span> @vQuery <span style="color:grey;"><span style="color:grey;">=</span></span> </span><span style="color:red;"><span style="color:red;"><span>Nâ€™update #Compare set dbB_TableFields </span></span></span><br /><span>= ( select count(*) from â€˜</span><br /><span> <span style="color:grey;"><span style="color:grey;">+</span></span> @dbB_Name <span style="color:grey;"><span style="color:grey;">+</span></span> </span><span style="color:red;"><span style="color:red;"><span>â€™..syscolumns </span></span></span><span>where id = object_id (Nâ€™â€™â€™</span><br /><span> <span style="color:grey;"><span style="color:grey;">+</span></span> @dbB_Name <span style="color:grey;"><span style="color:grey;">+</span></span> </span><span style="color:red;"><span style="color:red;"><span>â€™..â€™â€™ + dbB_TableName ) )</span></span></span><span>from #Compare where dbB_TableName is not nullâ€™</span><br /><span><span style="color:blue;"><span style="color:blue;">exec</span></span> <span style="color:maroon;"><span style="color:maroon;">sp_executesql</span></span><span style="color:blue;"><span style="color:blue;"> </span></span></span><span>@vQuery</span><br /><span></span><br /><span><span style="color:blue;"><span style="color:blue;">declare</span></span> @Compare <span style="color:blue;"><span style="color:blue;">table</span></span> </span><br /><span style="color:blue;"><span style="color:blue;"></span></span><span><span style="color:grey;"><span style="color:grey;">(</span></span>TableName <span style="color:blue;"><span style="color:blue;">sysname</span></span> <span style="color:grey;"><span style="color:grey;">not</span></span> <span style="color:grey;"><span style="color:grey;">null,</span></span> ExistInDbA <span style="color:blue;"><span style="color:blue;">int</span></span><span style="color:grey;"><span style="color:grey;">,</span></span> ExistInDbB <span style="color:blue;"><span style="color:blue;">int</span></span><span style="color:grey;"><span style="color:grey;">,</span></span> FieldsInDbA <span style="color:blue;"><span style="color:blue;">int</span></span><span style="color:grey;"><span style="color:grey;">,</span></span> FieldsInDbB <span style="color:blue;"><span style="color:blue;">int</span></span><span style="color:grey;"><span style="color:grey;">)</span></span></span><span><span style="color:blue;"><span style="color:blue;">insert</span></span> <span style="color:blue;"><span style="color:blue;">into</span></span></span><span> @Compare</span><br /><span><span style="color:blue;"><span style="color:blue;">select</span></span> TableName <span style="color:grey;"><span style="color:grey;">=</span></span> <span style="color:magenta;"><span style="color:magenta;">isnull</span></span><span style="color:grey;"><span style="color:grey;">(</span></span> dbA_TableName<span style="color:grey;"><span style="color:grey;">,</span></span> dbB_TableName <span style="color:grey;"><span style="color:grey;">)</span></span></span><span> </span><br /><span><span style="color:grey;"><span style="color:grey;">,</span></span> ExistInDbA <span style="color:grey;"><span style="color:grey;">=</span></span><span style="color:blue;"><span style="color:blue;"> </span></span><span style="color:grey;"><span style="color:grey;">(</span></span> <span style="color:blue;"><span style="color:blue;">case</span></span> <span style="color:blue;"><span style="color:blue;">when</span></span> dbA_TableName <span style="color:grey;"><span style="color:grey;">is</span></span> <span style="color:grey;"><span style="color:grey;">null</span></span> <span style="color:blue;"><span style="color:blue;">then</span></span> 0 <span style="color:blue;"><span style="color:blue;">else</span></span> 1 <span style="color:blue;"><span style="color:blue;">end</span></span> <span style="color:grey;"><span style="color:grey;">)</span></span></span><br /><span><span style="color:grey;"><span style="color:grey;">,</span></span> ExistInDbB <span style="color:grey;"><span style="color:grey;">=</span></span><span style="color:blue;"><span style="color:blue;"> </span></span><span style="color:grey;"><span style="color:grey;">(</span></span> <span style="color:blue;"><span style="color:blue;">case</span></span> <span style="color:blue;"><span style="color:blue;">when</span></span> dbB_TableName <span style="color:grey;"><span style="color:grey;">is</span></span> <span style="color:grey;"><span style="color:grey;">null</span></span> <span style="color:blue;"><span style="color:blue;">then</span></span> 0 <span style="color:blue;"><span style="color:blue;">else</span></span> 1 <span style="color:blue;"><span style="color:blue;">end</span></span> <span style="color:grey;"><span style="color:grey;">)</span></span></span><br /><span><span style="color:grey;"><span style="color:grey;">,</span></span> FieldsInDbA <span style="color:grey;"><span style="color:grey;">=</span></span></span><span> dbA_TableFields</span><br /><span><span style="color:grey;"><span style="color:grey;">,</span></span> FieldsInDbB <span style="color:grey;"><span style="color:grey;">=</span></span></span><span> dbB_TableFields</span><br /><span style="color:blue;"><span>from</span></span><span> #Compare</span><br /><span><span style="color:blue;"><span style="color:blue;">where</span></span> <span style="color:magenta;"><span style="color:magenta;">isnull</span></span><span style="color:grey;"><span style="color:grey;">(</span></span> dbA_TableName<span style="color:grey;"><span style="color:grey;">,</span></span> dbB_TableName <span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;">like</span></span></span><span> @TableNameLike</span><br /><span><span style="color:grey;"><span style="color:grey;">and</span></span><span style="color:blue;"><span style="color:blue;"> </span></span><span style="color:grey;"><span style="color:grey;">(</span></span> <span style="color:blue;"><span style="color:blue;">case</span></span> <span style="color:blue;"><span style="color:blue;">when </span></span><span style="color:grey;"><span style="color:grey;">(</span></span> <span style="color:magenta;"><span style="color:magenta;">isnull</span></span><span style="color:grey;"><span style="color:grey;">(</span></span> dbA_TableFields<span style="color:grey;"><span style="color:grey;">,</span></span> 0 <span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;"></span></span> <span style="color:magenta;"><span style="color:magenta;">isnull</span></span><span style="color:grey;"><span style="color:grey;">(</span></span> dbB_TableFields<span style="color:grey;"><span style="color:grey;">,</span></span> 0 <span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;">)</span></span></span><span> </span><br /><span><span style="color:blue;"><span style="color:blue;">then</span></span> 1 <span style="color:blue;"><span style="color:blue;">else</span></span> 0 <span style="color:blue;"><span style="color:blue;">end</span></span> <span style="color:grey;"><span style="color:grey;">)</span></span> <span style="color:grey;"><span style="color:grey;">&gt;=</span></span></span><span> @CompareOnlyDifference</span><br /><span><span style="color:blue;"><span style="color:blue;">set</span></span> <span style="color:blue;"><span style="color:blue;">nocount</span></span> <span style="color:blue;"><span style="color:blue;">off</span></span></span><span> </span><br /><span><span style="color:blue;"><span style="color:blue;">select</span></span> <span style="color:grey;"><span style="color:grey;">*</span></span> <span style="color:blue;"><span style="color:blue;">from</span></span> @Compare</span><br /><span style="color:blue;"><span>GO</span></span></p>
:ET